!function(){var g,i,l;function y(t,e){var n,l={}.hasOwnProperty;for(n in e)l.call(e,n)&&(t[n]=e[n]);return t}(g=function(t){var i,s,c,o,d,u,p,f,e,r,n;return this.opt=t=y({},t=null==t?{}:t),this.root=i="string"==typeof t.root?document.querySelector(t.root):t.root,this.el=s={},s.ed={picker:ld$.find(i,".ldcolorpicker",0),pal:ld$.find(i,".ldp",0),colors:ld$.find(i,".ldp .colors",0),hex:ld$.find(i,"input[data-tag=hex]",0),sel:ld$.find(i,"select",0),cfgs:ld$.find(i,".config")},c={stack:[],cur:null,handle:null,undo:function(){var t=c.stack.pop();if(t)return s.ed.pal.innerHTML=t,s.ed.colors=ld$.find(s.ed.pal,".colors",0)},push:function(t){var e,n=this;return null==t&&(t=!1),(e=this.handle)&&clearTimeout(e),this.cur||(this.cur=s.ed.pal.innerHTML),e=function(){var t;return(t=n.stack)[t.length-1]!==n.cur&&n.stack.push(n.cur),n.handle=null,n.cur=null,n},t?e():this.handle=setTimeout(e,200)},clear:function(){return this.stack.splice(0),this.handle&&clearTimeout(this.handle),this.handle=null,this.cur=null,this}},this.undo=function(){return c.undo()},this.clearLog=function(){return c.clear()},this.ldcp=o=new ldcolorpicker(s.ed.picker,{inline:!0}),o.on("change",function(t){return c.push(),r(t)}),this.ldrs=d={},y(u={base:{min:0,max:255,step:1,hide_min_max:!0,hide_from_to:!0,grid:!1}},{"hsl-h":((e=y({},u.base)).max=360,e),"hsl-s":((e=y({},u.base)).max=1,e.step=.01,e),"hsl-l":((e=y({},u.base)).max=1,e.step=.01,e),"hcl-h":((e=y({},u.base)).max=360,e),"hcl-c":((e=y({},u.base)).max=230,e),"hcl-l":((e=y({},u.base)).max=100,e)}),u["rgb-r"]=u["rgb-g"]=u["rgb-b"]=u.base,["rgb-r","rgb-g","rgb-b","hsl-h","hsl-s","hsl-l","hcl-h","hcl-c","hcl-l"].map(function(t){return l=(e=t).split("-"),r=function(t){var e=o.getColor(l[0]);return e[l[1]]=t.target.value,o.setColor(e)},a=debounce(500,r),(t=ld$.find(i,".value[data-tag="+e+"]",0)).addEventListener("change",r),t.addEventListener("input",a),d[e]=new ldslider(y({root:ld$.find(i,".ldrs[data-tag="+e+"]",0)},u[e])),d[n=e].on("change",function(t){var e;return o._slider=n,(e=o.getColor(l[0]))[l[1]]=t,o.setColor(e)});var e,n,l,r,a}),s.ed.hex.addEventListener("change",function(t){return o.setColor(t.target.value)}),s.ed.hex.addEventListener("input",debounce(500,function(t){return o.setColor(t.target.value)})),s.ed.sel.addEventListener("change",function(e){var t,n,l,r=[];for(t in s.ed.cfgs.map(function(t){return t.classList[ld$.attr(t,"data-tag")===e.target.value?"add":"remove"]("active")}),n=d)l=n[t],r.push(l.update());return r}),p=function(t){var e,n=f.data.box;return f.data.colors.length*((t=0<(e=t.clientX-n.x)?e:0)<(e=n.width)?t:e)/n.width},f=function(t){var e,n=f.data,l=(n.box,n.srcidx),r=n.initx,a=n.colors,i=n.span,o=Math.round(p(t)),d=s.ed.colors.childNodes[l],i=(n=(e=t.clientX-r)>(r=-l*i)?e:r)<(i=(a.length-l-1)*i)?n:i;if(d.style.transform="translate("+i+"px,0)",l!==o&&l+1!==o)return d.style.transform="translate(0,0)",f.data.initx=t.clientX,c.push(),d=s.ed.colors.childNodes[l],t=s.ed.colors.childNodes[o],d.remove(),s.ed.colors.insertBefore(d,t),f.data.srcidx=o<l?o:o-1},s.ed.pal.addEventListener("mousedown",function(t){if(ld$.parent(t.target,".colors",s.ed.pal))return f.data={initx:t.clientX,colors:ld$.find(s.ed.colors,".color"),box:s.ed.colors.getBoundingClientRect()},f.data.srcidx=Math.floor(p(t)),f.data.span=f.data.box.width/f.data.colors.length,document.removeEventListener("mousemove",f),document.addEventListener("mousemove",f)}),s.ed.pal.addEventListener("mouseup",function(t){if(ld$.parent(t.target,".colors",s.ed.pal))return ld$.find(s.ed.colors,".color").map(function(t){return t.style.transform=""}),document.removeEventListener("mousemove",f)}),document.addEventListener("mouseup",function(){return document.removeEventListener("mousemove",f)}),this.init=e=function(t){var e,n=(e=[(t=y({pal:{}},t=null==t?{}:t)).pal.hexs||t.pal.colors.map(function(t){return ldcolor.hex(t)}),t.pal.key,t.pal.name||"Custom"])[0],l=e[2],t=s.ed.colors.parentNode;return(e=e[1])?t.setAttribute("data-key",e):t.removeAttribute("data-key"),s.ed.colors.innerHTML=n.map(function(t,e){return'<div class="color'+(e?"":" active")+(ldcolor.hcl(t).l<50?" dark":"")+'"\nstyle="background:'+t+";color:"+t+'">\n  <div data-action>\n    <i class="i-clone"></i>\n    <i class="i-bars"></i>\n    <i class="i-close"></i>\n  </div>\n</div>'}).join(""),ld$.find(t,".name",0).innerHTML=l||"untitled",r(n[0]),o.setColor(n[0])},r=function(n){var t=ldcolor.hcl(n),e=ld$.find(i,".color.active",0);return e.style.background=ldcolor.rgbaStr(n),e.classList[t.l<50?"add":"remove"]("dark"),s.ed.hex.value=ldcolor.hex(n),n={rgb:ldcolor.rgb(n),hsl:ldcolor.hsl(n),hcl:t},["rgb-r","rgb-g","rgb-b","hsl-h","hsl-s","hsl-l","hcl-h","hcl-c","hcl-l"].map(function(t){var e=t.split("-"),e=n[e[0]][e[1]];return"hsl-s"!==t&&"hsl-l"!==t&&(e=Math.round(e)),ld$.find(i,".value[data-tag="+t+"]",0).value=e,o._slider===t?o._slider=null:d[t].set(e)})},n={editColor:function(t){var e,n=ld$.parent(t,"i",s.ed.pal),l=ld$.parent(t,".color",s.ed.pal);if(n&&!n.classList.contains("i-bars")&&l.classList.contains("active")){if(n.classList.contains("i-close"))return l.parentNode.childNodes.length<=1||(c.push(),l.classList.contains("active")&&(e=l.parentNode.childNodes[ld$.index(l)+1]||l.parentNode.childNodes[ld$.index(l)-1])&&e.classList.add("active"),l.remove()),!0;if(n.classList.contains("i-clone"))return n=l.cloneNode(!0),ld$.child(l.parentNode).map(function(t){return t.classList.remove("active")}),n.classList.add("active"),ld$.insertAfter(l.parentNode,n,l),!0}if(l)return ld$.child(l.parentNode).map(function(t){return t.classList[t===l?"add":"remove"]("active")}),o.setColor(l.style.backgroundColor),!0}},i.addEventListener("click",function(t){t=t.target;n.editColor(t)}),this.getPal=function(){var t=s.ed.colors.parentNode,e=ld$.attr(t,"data-key"),t=ld$.find(t,".name",0).textContent||"untitled";return{colors:ld$.find(s.ed.colors,".color").map(function(t){return{value:ldcolor.rgbaStr(t.style.backgroundColor)}}),name:t,key:e}},e({pal:t.palette||JSON.parse(JSON.stringify(g.defaultPalette))}),this}).prototype=y(Object.create(Object.prototype),{syncUi:function(){var t,e,n,l=[];for(t in e=this.ldrs)n=e[t],l.push(n.update());return l}}),g.defaultPalette={name:"sample",colors:["#E8614C","#F4A358","#E8DA8D","#2DA88B","#294B59"]},i={"zh-TW":{search:"搜尋",USE:"套用",EDIT:"編輯",view:"檢視","my pals":"我的色盤",edit:"編輯",filter:"過濾",all:"全部",artwork:"創作",brand:"品牌",concept:"概念",gradient:"漸層",qualitative:"定性",diverging:"雙色",colorbrew:"釀色","load more":"更多","use this palette":"使用此色盤","save as asset":"儲存色盤",undo:"undo","no result...":"沒有可用的色盤..."}},(l=function(p){var u,f,h,n,l,r,a,v,e,t,m=this;return null==p&&(p={}),this.opt=p,this.i18n=p.i18n||{t:function(t){return t}},this.i18n&&this.i18n.addResourceBundles&&this.i18n.addResourceBundles(i),p.palettes||(p.palettes=[]),p.itemPerLine||(p.itemPerLine=2),this.pals={view:p.palettes},this.root=u="string"==typeof p.root?document.querySelector(p.root):p.root,p.className&&this.root.classList.add.apply(this.root.classList,p.className.split(" ").filter(function(t){return t}).map(function(t){return t.trim()})),this.el=f={},f.nv={root:ld$.find(u,".header",0),search:ld$.find(u,"input[data-tag=search]",0),filter:ld$.find(u,".input-group-append",0)},f.pn={view:ld$.find(u,".panel[data-panel=view]",0),mypal:ld$.find(u,".panel[data-panel=mypal]",0),edit:ld$.find(u,".panel[data-panel=edit]",0)},f.pnin={view:ld$.find(f.pn.view,".inner",0),mypal:ld$.find(f.pn.mypal,".inner",0)},f.ed={save:ld$.find(f.pn.edit,"*[data-action=save]",0)},f.mp={load:ld$.find(f.pn.mypal,".btn-load",0)},Array.from(this.root.querySelectorAll("[t]")).map(function(t){return t.textContent=m.i18n.t(t.getAttribute("t"))}),f.nv.search.setAttribute("placeholder",this.i18n.t("search")+"..."),h={pals:{},add:function(t,e){var n,l=this;return this.pals[t=null==t?"view":t]||(this.pals[t]=[]),(n=this.pals)[t]=n[t].concat(e.map(function(t){return{html:l.html(t),obj:t}}))},build:function(t,e){var n,l,r,a,i,o,d,s,c,u;if("edit"===(e=null==e?"view":e)&&(e="view"),0===(n=(t=null==t?[]:t).map(function(t){return t.html})).length)return f.pnin[e].innerHTML=m.i18n.t("no result...");if(p.useVscroll&&"undefined"!=typeof vscroll&&null!==vscroll||!p.useClusterizejs||"undefined"==typeof Clusterize||null===Clusterize)return p.useVscroll&&"undefined"!=typeof vscroll&&null!==vscroll?((m.vscroll||(m.vscroll={}))[e]||((t=f.pnin[e].style).height="100%",t.overflowY="scroll",m.vscroll[e]=new vscroll.fixed({root:f.pnin[e]}),m.ldcv&&m.ldcv.on("toggle.on",function(){return m.vscroll[e].setchild((m._rows||n).join("")),m.vscroll[e].update(40)})),m._rows=n,m.vscroll[e].setchild(n.join("")),m.vscroll[e].update(40)):f.pnin[e].innerHTML=n.join("");for(l=[],r=0,i=n.length,a=p.itemPerLine;a<0?i<r:r<i;r+=a){for(o=r,d=[],s=0,c=p.itemPerLine;s<c;++s)u=s,d.push(n[o+u]);l.push('<div class="clusterize-row">'+d.join("")+"</div>")}return(h.cluster||(h.cluster={}))[e]?h.cluster[e].update(l):(h.cluster||(h.cluster={}))[e]=new Clusterize({rows_in_block:7,rows:l,contentElem:f.pnin[e],scrollElem:f.pn[e]})},html:function(t){var e=t.colors.map(function(t){return'<div class="color" style="background:'+ldcolor.rgbaStr(t)+'"></div>'}).join("");return'<div class="ldp"'+(t.key?' data-key="'+t.key+'"':"")+'>\n  <div class="colors">\n  <div class="ctrl">\n  <div data-action="use"><i class="i-check"></i>'+m.i18n.t("USE")+'</div>\n  <div data-action="edit"><i class="i-gear"></i>'+m.i18n.t("EDIT")+"</div>\n  </div>\n  "+e+'\n  </div>\n  <div class="name">'+(t.name||"untitled")+"</div>\n</div>"}},null!=p.mypal?((n={loader:new ldloader({root:f.mp.load,autoZ:!0}),page:Object.create(p.mypal),fetch:function(){return this.page.fetch().then(function(t){return h.add("mypal",t),h.build(h.pals.mypal,"mypal")})}}).page.setHost(f.pn.mypal),f.mp.load.addEventListener("click",function(){return n.loader.on().then(function(){return n.page.fetch()}).then(function(t){return debounce(100),t}).then(function(t){return h.add("mypal",t),h.build(h.pals.mypal,"mypal")}).then(function(){return n.loader.off(100)}).then(function(){if(n.page.isEnd())return f.mp.load.style.display="none"})})):(ld$.find(f.nv.root,".btn[data-panel=mypal]",0).style.display="none",ld$.remove(f.pn.mypal)),l=function(t){var e,n=ld$.find(t,".ldp",0)||ld$.parent(t,".ldp",u),l=(e=n)?[ld$.attr(n,"data-key"),ld$.find(e,".name",0).innerText]:[null,"untitled"],n=l[0];return{name:l[1],hexs:(e=ld$.find(t,".colors",0)||ld$.parent(t,".colors",u))?ld$.find(e,".color").map(function(t){return ldcolor.hex(t.style.backgroundColor||t.style.background)}):[],key:n}},r=function(t){var e=l(t),n=e.name,t=e.hexs,e=e.key;return m.fire("use",t={name:n,key:e,colors:t.map(function(t){return ldcolor.rgb(t)})}),m.ldcv?m.ldcv.set(t):m._set(t)},a=function(e){var t;return null==e&&(e=""),t=(t=ld$.find(f.nv.root,".active",0))?ld$.attr(t,"data-panel"):"view",e?(e=e.toLowerCase().trim(),h.build((h.pals[t="edit"===t?"view":t]||[]).filter(function(t){return 0<=(t.obj.name||"untitled").indexOf(e)||(t.obj.tag||[]).filter(function(t){return 0<=t.indexOf(e)}).length}),t),m.tab(t)):h.build(h.pals[t]||[],t)},f.nv.search.addEventListener("keyup",function(t){return a(t.target.value||"")}),"undefined"!=typeof BSN&&null!==BSN&&new BSN.Dropdown(f.nv.filter),null!=p.save&&(v={loader:new ldloader({root:f.ed.save,autoZ:!0}),save:p.save}),e={save:function(t){var e,n,l,r,a,i,o,d,s,c;if(!ld$.parent(t,"[data-action=save]",u))return!1;if(null==v)return!0;for(v.loader.on(),e=m.ldpe.getPal(),n=e.colors,l=e.name,r=e.key,a=(e=[800,300,n.length])[0],i=e[1],o=e[2],t=document.createElement("canvas"),document.body.appendChild(t),(e=t.style).display="block",e.position="absolute",e.zIndex=-1,e.opacity=0,e.visibility="hidden",t.width=a,t.height=i,(d=t.getContext("2d")).fillStyle="#ffffff",d.fillRect(0,0,t.width,t.height),s=0;s<o;++s)c=s,d.fillStyle=n[c].value,d.fillRect(.5*(a-600)+c/o*600,.5*(i-150),600/o,150);return t.toBlob(function(t){return v.save({thumb:t,data:{name:l,type:"palette",payload:{colors:n}}},r).finally(function(){return v.loader.off(500)}).then(function(t){if(t)return m.ldpe.init({pal:t})})}),!0},use:function(t){var e;return!!ld$.parent(t,"[data-action=use]",u)&&((e=ld$.parent(t,".ldp *[data-action]",u))||(e=ld$.parent(t,".panel[data-panel=edit]",u))&&(e=ld$.find(e,".ldp",0))?r(e)||!0:void 0)},mypal:function(t){var e;if(e=ld$.parent(t,".header",u))return ld$.parent(t,"*[data-panel=mypal]",e)?null==n?m.tab("view"):(m.tab("mypal"),n.fetch()):void 0},view:function(t){var e;if(e=ld$.parent(t,".header",u))return ld$.parent(t,"*[data-panel=view]",e)?(m.tab("view"),a(f.nv.search.value||"")):(e=ld$.parent(t,"*[data-cat]",e))?(m.tab("view"),a(f.nv.search.value=ld$.attr(e,"data-cat")||"")):void 0},edit:function(t){if(t=ld$.parent(t,".ldp *[data-action]",u))return"edit"===ld$.attr(t,"data-action")?(m.tab("edit"),m.ldpe.init({pal:l(t)}),!0):void 0},undo:function(t){if(ld$.parent(t,"*[data-action=undo]",u))return m.ldpe.undo()||!0},nav:function(t){if(t=ld$.parent(t,"[data-panel]",u))return ld$.parent(t,".header",u)?m.tab(ld$.attr(t,"data-panel")):void 0}},u.addEventListener("click",function(t){t=t.target;e.save(t)||e.use(t)||e.mypal(t)||e.view(t)||e.edit(t)||e.undo(t)||e.nav(t)}),this.access={list:[]},this.evtHandler={},"undefined"!=typeof ldcover&&null!==ldcover&&p.ldcv&&(t=ld$.parent(this.root,".ldcv"))&&(this.ldcv=new ldcover(y({root:t},"object"==typeof p.ldcv?p.ldcv:{}))),h.add("view",p.palettes),h.build(h.pals.view),t={root:f.pn.edit},p.palette&&(t.palette=p.palette),this.ldpe=new g(t),this.edit=function(t,e){if(null==e&&(e=!0),m.ldpe.init({pal:t}),e)return m.tab("edit")},this.tabDisplay=debounce(1e3,function(){var n=m.tabIdx;return ld$.find(m.root,".panel").map(function(t,e){if(n!==e)return t.style.display="none"})}),this}).prototype=y(Object.create(Object.prototype),{on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){for(var e,n,l,r,a=[],i=[],o=1,d=arguments.length;o<d;++o)i.push(arguments[o]);for(e=i,o=0,l=(n=this.evtHandler[t]||[]).length;o<l;++o)r=n[o],a.push(r.apply(this,e));return a},_get:function(){var n=this;return new Promise(function(t,e){return n.access.list.push({res:t,rej:e})})},_set:function(e){return this.access.list.splice(0).map(function(t){return t.res(e)})},get:function(){return this.ldcv?this.ldcv.get():this._get()},tab:function(e){var n,t;if(e&&(this.tabIdx=n=(t=ld$.find(this.root,".panel[data-panel="+e+"]",0))?ld$.index(t):-1,!(n<0)))return ld$.find(this.root,".panels",0).style.transform="translate("+-100*n+"%,0)",ld$.find(this.root,".panel").map(function(t,e){if(n===e)return t.style.display=""}),ld$.find(this.root,".btn[data-panel]").map(function(t){return t.classList.toggle("btn-text",ld$.attr(t,"data-panel")!==e),t.classList.toggle("btn-primary",ld$.attr(t,"data-panel")===e)}),this.tabDisplay(),this.ldpe.syncUi(),!0},random:function(){var t=this.opt.palettes;return this.opt.random?Array.isArray(this.opt.random)?this.opt.random[Math.floor(Math.random()*this.opt.random.length)]:this.opt.random():t[Math.floor(Math.random()*t.length)]}}),y(l,{palettes:[],parse:{text:function(t){return t.split("\n").filter(function(t){return t}).map(function(t){return{name:(t=t.split(",").map(function(t){return t.toLowerCase()}))[0],colors:t[1].split(" ").map(function(t){return"#"+t}),tag:t.slice(2)}})}},register:function(t,e){return"string"==typeof e&&(e=this.parse.text(e)),this.palettes.push([t,e])},get:function(e){return(this.palettes.filter(function(t){return t[0]===e})[0]||["",[]])[1]},init:function(e){var n=(e=null==e?{}:e).pals||this.get("default");return Array.from(document.querySelectorAll("*[ldpp]")).map(function(t){return new l(y({palettes:n,root:t},e))})},defaultPalette:{name:"sample",colors:["#E8614C","#F4A358","#E8DA8D","#2DA88B","#294B59"]}}),l.register("default","flourish,b22 e55 f87 fb6 ab8 898,qualitative\ngray,000 333 666 ddd fff,gradient\nyoung,fec fe6 cd9 acd 7ab aac,concept\nplotDB,ed1e79 c69c6d 8cc63f 29abe2,brand\nFrench,37a 9ab eee f98 c10,diverging\nAfghan Girl,010 253 ffd da8 b53,artwork"),"undefined"!=typeof module&&null!==module?module.exports=l:"undefined"!=typeof window&&null!==window&&(window.ldpp=l)}.call(this);
