!function(){var t;function n(t,e){var n,i={}.hasOwnProperty;for(n in e)i.call(e,n)&&(t[n]=e[n]);return t}(t=function(t){var e=this;return(t=null==t?{}:t).fetch&&(this._user_fetch=t.fetch),this._evthdr={},this._running=!1,this._end=!1,this._disabled=null!=t.enabled&&!t.enabled,this._o=n({boundary:5,scrollDelay:100,fetchDelay:200,fetchOnScroll:!1,fetchOnInit:!1},t),this.limit=t.limit||20,this.offset=t.offset||0,t.host&&this.host(t.host),t.pivot&&this.pivot(t.pivot),this.fetch=debounce(this._o.fetchDelay,this._fetch),this._pend=proxise(function(){if(!e._running)return Promise.resolve()}),"always"!==(t=this._o.fetchOnInit)&&"once"!==t||this.fetch(),this}).prototype=n(Object.create(Object.prototype),{_user_fetch:function(){return new Promise(function(t,e){return t([])})},toggle:function(t){return this._disabled=null!=t?!t:!this._disabled},on:function(t,n){var i=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;return((e=i._evthdr)[t]||(e[t]=[])).push(n)})},fire:function(t){for(var e,n,i,s,o=[],r=[],h=1,l=arguments.length;h<l;++h)r.push(arguments[h]);for(e=r,h=0,i=(n=this._evthdr[t]||[]).length;h<i;++h)s=n[h],o.push(s.apply(this,e));return o},reset:function(t){var e=this;return null==t&&(t={}),this._pend().then(function(){if(e.offset=0,e._end=!1,"always"===e._o.fetchOnInit)return e.fetch()})},fetchable:function(){return!(this._disabled||this._end||this._running)},isEnd:function(){return this._end},obs:function(){var n=this;return this._obs||(this._obs=new IntersectionObserver(function(t){var e;if(t.map(function(t){return t.isIntersecting}).filter(function(t){return t}).length&&n.fetchable())return e=t.filter(function(t){return t.target===n._pivot}).length,t=t.filter(function(t){return t.target===n._host}).length,n._o.fetchOnScroll&&e||"lazy"===n._o.fetchOnInit&&t&&!n.offset?n.fetch().then(function(t){return n.fire("scroll.fetch",t)}):void 0},{}),this._obs)},_onScroll:function(){var t,e=this;if(this.fetchable()&&!((t=this._host).scrollHeight-t.scrollTop-t.clientHeight>this._o.boundary))return this.fetch().then(function(t){return e.fire("scroll.fetch",t)})},host:function(t){var e,n=this;return t?(e=this.obs(),this._host&&this._scrollFunc&&((this._host===document.scrollingElement?document:this._host).removeEventListener("scroll",this._scrollFunc),this._scrollFunc=null),this._host&&e.unobserve(this._host),this._host="string"==typeof t?document.querySelector(t):t,this._host?(this._o.fetchOnScroll&&!this._pivot&&(this._scrollFunc=function(t){return n._onScroll(t)},(this._host===document.scrollingElement?document:this._host).addEventListener("scroll",this._scrollFunc)),e.observe(this._host)):void 0):this._host},pivot:function(t){var e;return t?(e=this.obs(),this._pivot&&e.unobserve(this._pivot),this._pivot="string"==typeof t?document.querySelector(t):t,e.observe(this._pivot=t),this._host&&this._scrollFunc?((this._host===document.scrollingElement?document:this._host).removeEventListener("scroll",this._scrollFunc),this._scrollFunc=null):void 0):this._pivot},_fetch:function(t){var e=this;return null==t&&(t={}),this.fetchable()?(this.fire("fetching"),this._running=!0,this._user_fetch().then(function(t){return null==t&&(t=[]),e._running=!1,e.offset+=t.length||0,e.fire("fetch",t),t.length<e.limit&&(e._end=!0,e.fire(e.offset?"finish":"empty")),e._pend.resolve(),t})):Promise.resolve([])}}),"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.paginate=t)}.call(this);
