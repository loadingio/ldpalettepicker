!function(){var i,l;function o(t,e){var n,l={}.hasOwnProperty;for(n in e)l.call(e,n)&&(t[n]=e[n]);return t}i={"zh-TW":{search:"搜尋",USE:"套用",EDIT:"編輯",view:"檢視","my pals":"我的色盤",edit:"編輯",filter:"過濾",all:"全部",artwork:"創作",brand:"品牌",concept:"概念",gradient:"漸層",qualitative:"定性",diverging:"雙色",colorbrew:"釀色","load more":"更多","use this palette":"使用此色盤","save as asset":"儲存色盤",undo:"undo","no result...":"沒有可用的色盤..."}},(l=function(p){var c,f,v,n,l,a,r,h,e,t,m=this;return null==p&&(p={}),this.opt=p,this.i18n=p.i18n||{t:function(t){return t}},this.i18n&&this.i18n.addResourceBundles&&this.i18n.addResourceBundles(i),p.palettes||(p.palettes=[]),p.itemPerLine||(p.itemPerLine=2),this.pals={view:p.palettes},this.root=c="string"==typeof p.root?document.querySelector(p.root):p.root,p.className&&this.root.classList.add.apply(this.root.classList,p.className.split(" ").filter(function(t){return t}).map(function(t){return t.trim()})),this.el=f={},f.nv={root:ld$.find(c,".header",0),search:ld$.find(c,"input[data-tag=search]",0),filter:ld$.find(c,".input-group-append",0)},f.pn={view:ld$.find(c,".panel[data-panel=view]",0),mypal:ld$.find(c,".panel[data-panel=mypal]",0),edit:ld$.find(c,".panel[data-panel=edit]",0)},f.pnin={view:ld$.find(f.pn.view,".inner",0),mypal:ld$.find(f.pn.mypal,".inner",0)},f.ed={save:ld$.find(f.pn.edit,"*[data-action=save]",0)},f.mp={load:ld$.find(f.pn.mypal,".btn-load",0)},Array.from(this.root.querySelectorAll("[t]")).map(function(t){return t.textContent=m.i18n.t(t.getAttribute("t"))}),f.nv.search.setAttribute("placeholder",this.i18n.t("search")+"..."),v={pals:{},add:function(t,e){var n,l=this;return this.pals[t=null==t?"view":t]||(this.pals[t]=[]),(n=this.pals)[t]=n[t].concat(e.map(function(t){return{html:l.html(t),obj:t}}))},build:function(t,e){var n,l,a,r,i,o,d,s,u,c;if("edit"===(e=null==e?"view":e)&&(e="view"),0===(n=(t=null==t?[]:t).map(function(t){return t.html})).length)return f.pnin[e].innerHTML=m.i18n.t("no result...");if(p.useVscroll&&"undefined"!=typeof vscroll&&null!==vscroll||!p.useClusterizejs||"undefined"==typeof Clusterize||null===Clusterize)return p.useVscroll&&"undefined"!=typeof vscroll&&null!==vscroll?((m.vscroll||(m.vscroll={}))[e]||((t=f.pnin[e].style).height="100%",t.overflowY="scroll",m.vscroll[e]=new vscroll.fixed({root:f.pnin[e]}),m.ldcv&&m.ldcv.on("toggle.on",function(){return m.vscroll[e].setchild((m._rows||n).join("")),m.vscroll[e].update(40)})),m._rows=n,m.vscroll[e].setchild(n.join("")),m.vscroll[e].update(40)):f.pnin[e].innerHTML=n.join("");for(l=[],a=0,i=n.length,r=p.itemPerLine;r<0?i<a:a<i;a+=r){for(o=a,d=[],s=0,u=p.itemPerLine;s<u;++s)c=s,d.push(n[o+c]);l.push('<div class="clusterize-row">'+d.join("")+"</div>")}return(v.cluster||(v.cluster={}))[e]?v.cluster[e].update(l):(v.cluster||(v.cluster={}))[e]=new Clusterize({rows_in_block:7,rows:l,contentElem:f.pnin[e],scrollElem:f.pn[e]})},html:function(t){var e=t.colors.map(function(t){return'<div class="color" style="background:'+ldcolor.rgbaStr(t)+'"></div>'}).join("");return'<div class="ldp"'+(t.key?' data-key="'+t.key+'"':"")+'>\n  <div class="colors">\n  <div class="ctrl">\n  <div data-action="use"><i class="i-check"></i>'+m.i18n.t("USE")+'</div>\n  <div data-action="edit"><i class="i-gear"></i>'+m.i18n.t("EDIT")+"</div>\n  </div>\n  "+e+'\n  </div>\n  <div class="name">'+(t.name||"untitled")+"</div>\n</div>"}},null!=p.mypal?((n={loader:new ldloader({root:f.mp.load,autoZ:!0}),page:Object.create(p.mypal),fetch:function(){return this.page.fetch().then(function(t){return v.add("mypal",t),v.build(v.pals.mypal,"mypal")})}}).page.setHost(f.pn.mypal),f.mp.load.addEventListener("click",function(){return n.loader.on().then(function(){return n.page.fetch()}).then(function(t){return debounce(100),t}).then(function(t){return v.add("mypal",t),v.build(v.pals.mypal,"mypal")}).then(function(){return n.loader.off(100)}).then(function(){if(n.page.isEnd())return f.mp.load.style.display="none"})})):(ld$.find(f.nv.root,".btn[data-panel=mypal]",0).style.display="none",ld$.remove(f.pn.mypal)),l=function(t){var e,n=ld$.find(t,".ldp",0)||ld$.parent(t,".ldp",c),l=(e=n)?[ld$.attr(n,"data-key"),ld$.find(e,".name",0).innerText]:[null,"untitled"],n=l[0];return{name:l[1],hexs:(e=ld$.find(t,".colors",0)||ld$.parent(t,".colors",c))?ld$.find(e,".color").map(function(t){return ldcolor.hex(t.style.backgroundColor||t.style.background)}):[],key:n}},a=function(t){var e=l(t),n=e.name,t=e.hexs,e=e.key;return m.fire("use",t={name:n,key:e,colors:t.map(function(t){return ldcolor.rgb(t)})}),m.ldcv?m.ldcv.set(t):m._set(t)},r=function(e){var t;return null==e&&(e=""),t=(t=ld$.find(f.nv.root,".active",0))?ld$.attr(t,"data-panel"):"view",e?(e=e.toLowerCase().trim(),v.build((v.pals[t="edit"===t?"view":t]||[]).filter(function(t){return 0<=(t.obj.name||"untitled").indexOf(e)||(t.obj.tag||[]).filter(function(t){return 0<=t.indexOf(e)}).length}),t),m.tab(t)):v.build(v.pals[t]||[],t)},f.nv.search.addEventListener("keyup",function(t){return r(t.target.value||"")}),"undefined"!=typeof BSN&&null!==BSN&&new BSN.Dropdown(f.nv.filter),null!=p.save&&(h={loader:new ldloader({root:f.ed.save,autoZ:!0}),save:p.save}),e={save:function(t){var e,n,l,a,r,i,o,d,s,u;if(!ld$.parent(t,"[data-action=save]",c))return!1;if(null==h)return!0;for(h.loader.on(),e=m.ldpe.getPal(),n=e.colors,l=e.name,a=e.key,r=(e=[800,300,n.length])[0],i=e[1],o=e[2],t=document.createElement("canvas"),document.body.appendChild(t),(e=t.style).display="block",e.position="absolute",e.zIndex=-1,e.opacity=0,e.visibility="hidden",t.width=r,t.height=i,(d=t.getContext("2d")).fillStyle="#ffffff",d.fillRect(0,0,t.width,t.height),s=0;s<o;++s)u=s,d.fillStyle=n[u].value,d.fillRect(.5*(r-600)+u/o*600,.5*(i-150),600/o,150);return t.toBlob(function(t){return h.save({thumb:t,data:{name:l,type:"palette",payload:{colors:n}}},a).finally(function(){return h.loader.off(500)}).then(function(t){if(t)return m.ldpe.init({pal:t})})}),!0},use:function(t){var e;return!!ld$.parent(t,"[data-action=use]",c)&&((e=ld$.parent(t,".ldp *[data-action]",c))||(e=ld$.parent(t,".panel[data-panel=edit]",c))&&(e=ld$.find(e,".ldp",0))?a(e)||!0:void 0)},mypal:function(t){var e;if(e=ld$.parent(t,".header",c))return ld$.parent(t,"*[data-panel=mypal]",e)?null==n?m.tab("view"):(m.tab("mypal"),n.fetch()):void 0},view:function(t){var e;if(e=ld$.parent(t,".header",c))return ld$.parent(t,"*[data-panel=view]",e)?(m.tab("view"),r(f.nv.search.value||"")):(e=ld$.parent(t,"*[data-cat]",e))?(m.tab("view"),r(f.nv.search.value=ld$.attr(e,"data-cat")||"")):void 0},edit:function(t){if(t=ld$.parent(t,".ldp *[data-action]",c))return"edit"===ld$.attr(t,"data-action")?(m.tab("edit"),m.ldpe.init({pal:l(t)}),!0):void 0},undo:function(t){if(ld$.parent(t,"*[data-action=undo]",c))return m.ldpe.undo()||!0},nav:function(t){if(t=ld$.parent(t,"[data-panel]",c))return ld$.parent(t,".header",c)?m.tab(ld$.attr(t,"data-panel")):void 0}},c.addEventListener("click",function(t){t=t.target;e.save(t)||e.use(t)||e.mypal(t)||e.view(t)||e.edit(t)||e.undo(t)||e.nav(t)}),this.access={list:[]},this.evtHandler={},"undefined"!=typeof ldcover&&null!==ldcover&&p.ldcv&&(t=ld$.parent(this.root,".ldcv"))&&(this.ldcv=new ldcover(o({root:t},"object"==typeof p.ldcv?p.ldcv:{}))),v.add("view",p.palettes),v.build(v.pals.view),t={root:f.pn.edit},p.palette&&(t.palette=p.palette),this.ldpe=new ldpe(t),this.edit=function(t,e){if(null==e&&(e=!0),m.ldpe.init({pal:t}),e)return m.tab("edit")},this.tabDisplay=debounce(1e3,function(){var n=m.tabIdx;return ld$.find(m.root,".panel").map(function(t,e){if(n!==e)return t.style.display="none"})}),this}).prototype=o(Object.create(Object.prototype),{on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){for(var e,n,l,a,r=[],i=[],o=1,d=arguments.length;o<d;++o)i.push(arguments[o]);for(e=i,o=0,l=(n=this.evtHandler[t]||[]).length;o<l;++o)a=n[o],r.push(a.apply(this,e));return r},_get:function(){var n=this;return new Promise(function(t,e){return n.access.list.push({res:t,rej:e})})},_set:function(e){return this.access.list.splice(0).map(function(t){return t.res(e)})},get:function(){return this.ldcv?this.ldcv.get():this._get()},tab:function(e){var n,t;if(e&&(this.tabIdx=n=(t=ld$.find(this.root,".panel[data-panel="+e+"]",0))?ld$.index(t):-1,!(n<0)))return ld$.find(this.root,".panels",0).style.transform="translate("+-100*n+"%,0)",ld$.find(this.root,".panel").map(function(t,e){if(n===e)return t.style.display=""}),ld$.find(this.root,".btn[data-panel]").map(function(t){return t.classList.toggle("btn-text",ld$.attr(t,"data-panel")!==e),t.classList.toggle("btn-primary",ld$.attr(t,"data-panel")===e)}),this.tabDisplay(),this.ldpe.syncUi(),!0},random:function(){var t=this.opt.palettes;return this.opt.random?Array.isArray(this.opt.random)?this.opt.random[Math.floor(Math.random()*this.opt.random.length)]:this.opt.random():t[Math.floor(Math.random()*t.length)]}}),o(l,{palettes:[],parse:{text:function(t){return t.split("\n").filter(function(t){return t}).map(function(t){return{name:(t=t.split(",").map(function(t){return t.toLowerCase()}))[0],colors:t[1].split(" ").map(function(t){return"#"+t}),tag:t.slice(2)}})}},register:function(t,e){return"string"==typeof e&&(e=this.parse.text(e)),this.palettes.push([t,e])},get:function(e){return(this.palettes.filter(function(t){return t[0]===e})[0]||["",[]])[1]},init:function(e){var n=(e=null==e?{}:e).pals||this.get("default");return Array.from(document.querySelectorAll("*[ldpp]")).map(function(t){return new l(o({palettes:n,root:t},e))})},defaultPalette:{name:"sample",colors:["#E8614C","#F4A358","#E8DA8D","#2DA88B","#294B59"]}}),l.register("default","flourish,b22 e55 f87 fb6 ab8 898,qualitative\ngray,000 333 666 ddd fff,gradient\nyoung,fec fe6 cd9 acd 7ab aac,concept\nplotDB,ed1e79 c69c6d 8cc63f 29abe2,brand\nFrench,37a 9ab eee f98 c10,diverging\nAfghan Girl,010 253 ffd da8 b53,artwork"),"undefined"!=typeof module&&null!==module?module.exports=l:"undefined"!=typeof window&&null!==window&&(window.ldpp=l)}.call(this);
