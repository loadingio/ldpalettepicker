!function(){var i,a;function o(t,e){var n,a={}.hasOwnProperty;for(n in e)a.call(e,n)&&(t[n]=e[n]);return t}i={"zh-TW":{search:"搜尋",USE:"套用",EDIT:"編輯",view:"檢視","my pals":"我的色盤",edit:"編輯",filter:"過濾",all:"全部",artwork:"創作",brand:"品牌",concept:"概念",gradient:"漸層",qualitative:"定性",diverging:"雙色",colorbrew:"釀色","load more":"更多","use this palette":"使用此色盤","save as asset":"儲存色盤",undo:"還原",paste:"貼上","no result...":"沒有可用的色盤..."}},(a=function(c){var p,f,v,n,a,l,r,h,e,t,m=this;return null==c&&(c={}),this.opt=c,this.i18n=c.i18n||{t:function(t){return t}},this.i18n&&this.i18n.addResourceBundles&&this.i18n.addResourceBundles(i),c.palettes||(c.palettes=[]),c.itemPerLine||(c.itemPerLine=2),this.pals={view:c.palettes},this.root=p="string"==typeof c.root?document.querySelector(c.root):c.root,c.className&&this.root.classList.add.apply(this.root.classList,c.className.split(" ").filter(function(t){return t}).map(function(t){return t.trim()})),this.el=f={},f.nv={root:ld$.find(p,".header",0),search:ld$.find(p,"input[data-tag=search]",0),filter:ld$.find(p,".input-group-append",0)},f.pn={view:ld$.find(p,".panel[data-panel=view]",0),mypal:ld$.find(p,".panel[data-panel=mypal]",0),edit:ld$.find(p,".panel[data-panel=edit]",0)},f.pnin={view:ld$.find(f.pn.view,".inner",0),mypal:ld$.find(f.pn.mypal,".inner",0)},f.ed={save:ld$.find(f.pn.edit,"*[data-action=save]",0)},f.mp={load:ld$.find(f.pn.mypal,".btn-load",0)},Array.from(this.root.querySelectorAll("[t]")).map(function(t){return t.textContent=m.i18n.t(t.getAttribute("t"))}),f.nv.search.setAttribute("placeholder",this.i18n.t("search")+"..."),v={pals:{},add:function(t,e){var n,a=this;return this.pals[t=null==t?"view":t]||(this.pals[t]=[]),(n=this.pals)[t]=n[t].concat(e.map(function(t){return{html:a.html(t),obj:t}}))},build:function(t,e){var n,a,l,r,i,o,d,s,u,p;if("edit"===(e=null==e?"view":e)&&(e="view"),0===(n=(t=null==t?[]:t).map(function(t){return t.html})).length)return f.pnin[e].innerHTML=m.i18n.t("no result...");if(c.useVscroll&&"undefined"!=typeof vscroll&&null!==vscroll||!c.useClusterizejs||"undefined"==typeof Clusterize||null===Clusterize)return c.useVscroll&&"undefined"!=typeof vscroll&&null!==vscroll?((m.vscroll||(m.vscroll={}))[e]||((t=f.pnin[e].style).height="100%",t.overflowY="scroll",m.vscroll[e]=new vscroll.fixed({root:f.pnin[e]}),m.ldcv&&m.ldcv.on("toggle.on",function(){return m.vscroll[e].setchild((m._rows||n).join("")),m.vscroll[e].update(40)})),m._rows=n,m.vscroll[e].setchild(n.join("")),m.vscroll[e].update(40)):f.pnin[e].innerHTML=n.join("");for(a=[],l=0,i=n.length,r=c.itemPerLine;r<0?i<l:l<i;l+=r){for(o=l,d=[],s=0,u=c.itemPerLine;s<u;++s)p=s,d.push(n[o+p]);a.push('<div class="clusterize-row">'+d.join("")+"</div>")}return(v.cluster||(v.cluster={}))[e]?v.cluster[e].update(a):(v.cluster||(v.cluster={}))[e]=new Clusterize({rows_in_block:7,rows:a,contentElem:f.pnin[e],scrollElem:f.pn[e]})},html:function(t){var e=t.colors.map(function(t){return'<div class="color" style="background:'+ldcolor.rgbaStr(t)+'"></div>'}).join("");return'<div class="ldp"'+(t.key?' data-key="'+t.key+'"':"")+'>\n  <div class="colors">\n  <div class="ctrl">\n  <div data-action="use"><i class="i-check"></i>'+m.i18n.t("USE")+'</div>\n  <div data-action="edit"><i class="i-gear"></i>'+m.i18n.t("EDIT")+"</div>\n  </div>\n  "+e+'\n  </div>\n  <div class="name">'+(t.name||"untitled")+"</div>\n</div>"}},null!=c.mypal?((n={loader:new ldloader({root:f.mp.load,autoZ:!0}),page:c.mypal,fetch:function(){return this.page.fetch().then(function(t){return v.add("mypal",t),v.build(v.pals.mypal,"mypal")})}}).page.setHost?n.page.setHost(f.pn.mypal):n.page.host(f.pn.mypal),f.mp.load.addEventListener("click",function(){return n.loader.on().then(function(){return n.page.fetch()}).then(function(t){return debounce(100),t}).then(function(t){return v.add("mypal",t),v.build(v.pals.mypal,"mypal")}).then(function(){return n.loader.off(100)}).then(function(){if(n.page.isEnd())return f.mp.load.style.display="none"})})):(ld$.find(f.nv.root,".btn[data-panel=mypal]",0).style.display="none",ld$.remove(f.pn.mypal)),a=function(t){var e,n=ld$.find(t,".ldp",0)||ld$.parent(t,".ldp",p),a=(e=n)?[ld$.attr(n,"data-key"),ld$.find(e,".name",0).innerText]:[null,"untitled"],n=a[0];return{name:a[1],hexs:(e=ld$.find(t,".colors",0)||ld$.parent(t,".colors",p))?ld$.find(e,".color").map(function(t){return o({tag:(t.getAttribute("data-tag")||"").split(",").filter(function(t){return t})},ldcolor.hsl(t.style.backgroundColor||t.style.background))}):[],key:n}},l=function(t){var e=a(t),n=e.name,t=e.hexs,e=e.key;return m.fire("use",t={name:n,key:e,colors:t.map(function(t){var e=ldcolor.hsl(t);return e.tag=t.tag,e})}),m.ldcv?m.ldcv.set(t):m._set(t)},r=function(e){var t;return null==e&&(e=""),t=(t=ld$.find(f.nv.root,".active",0))?ld$.attr(t,"data-panel"):"view",e?(e=e.toLowerCase().trim(),v.build((v.pals[t="edit"===t?"view":t]||[]).filter(function(t){return 0<=(t.obj.name||"untitled").indexOf(e)||(t.obj.tag||[]).filter(function(t){return 0<=t.indexOf(e)}).length}),t),m.tab(t)):v.build(v.pals[t]||[],t)},f.nv.search.addEventListener("keyup",function(t){return r(t.target.value||"")}),"undefined"!=typeof BSN&&null!==BSN&&new BSN.Dropdown(f.nv.filter),null!=c.save&&(h={loader:new ldloader({root:f.ed.save,autoZ:!0}),save:c.save}),e={save:function(t){var e,n,a,l,r,i,o,d,s,u;if(!ld$.parent(t,"[data-action=save]",p))return!1;if(null==h)return!0;for(h.loader.on(),e=m.ldpe.getPal(),n=e.colors,a=e.name,l=e.key,r=(e=[800,300,n.length])[0],i=e[1],o=e[2],t=document.createElement("canvas"),document.body.appendChild(t),(e=t.style).display="block",e.position="absolute",e.zIndex=-1,e.opacity=0,e.visibility="hidden",t.width=r,t.height=i,(d=t.getContext("2d")).fillStyle="#ffffff",d.fillRect(0,0,t.width,t.height),s=0;s<o;++s)u=s,d.fillStyle=n[u].value,d.fillRect(.5*(r-600)+u/o*600,.5*(i-150),600/o,150);return t.toBlob(function(t){return h.save({thumb:t,data:{name:a,type:"palette",payload:{colors:n}}},l).finally(function(){return h.loader.off(500)}).then(function(t){if(t)return m.ldpe.init({pal:t})})}),!0},use:function(t){var e;return!!ld$.parent(t,"[data-action=use]",p)&&((e=ld$.parent(t,".ldp *[data-action]",p))||(e=ld$.parent(t,".panel[data-panel=edit]",p))&&(e=ld$.find(e,".ldp",0))?l(e)||!0:void 0)},mypal:function(t){var e;if(e=ld$.parent(t,".header",p))return ld$.parent(t,"*[data-panel=mypal]",e)?null==n?m.tab("view"):(m.tab("mypal"),n.fetch()):void 0},view:function(t){var e;if(e=ld$.parent(t,".header",p))return ld$.parent(t,"*[data-panel=view]",e)?(m.tab("view"),r(f.nv.search.value||"")):(e=ld$.parent(t,"*[data-cat]",e))?(m.tab("view"),r(f.nv.search.value=ld$.attr(e,"data-cat")||"")):void 0},edit:function(t){if(t=ld$.parent(t,".ldp *[data-action]",p))return"edit"===ld$.attr(t,"data-action")?(m.tab("edit"),m.ldpe.init({pal:a(t)}),!0):void 0},undo:function(t){if(ld$.parent(t,"*[data-action=undo]",p))return m.ldpe.undo()||!0},paste:function(t){if(ld$.parent(t,"*[data-action=paste]",p))return m.ldpe.paste()||!0},nav:function(t){if(t=ld$.parent(t,"[data-panel]",p))return ld$.parent(t,".header",p)?m.tab(ld$.attr(t,"data-panel")):void 0}},p.addEventListener("click",function(t){t=t.target;e.save(t)||e.use(t)||e.mypal(t)||e.view(t)||e.edit(t)||e.undo(t)||e.paste(t)||e.nav(t)}),this.access={list:[]},this.evtHandler={},"undefined"!=typeof ldcover&&null!==ldcover&&c.ldcv&&(t=ld$.parent(this.root,".ldcv"))&&(this.ldcv=new ldcover(o({root:t},"object"==typeof c.ldcv?c.ldcv:{}))),v.add("view",c.palettes),v.build(v.pals.view),t={root:f.pn.edit},c.palette&&(t.palette=c.palette),this.ldpe=new ldpe(t),this.edit=function(t,e){if(null==e&&(e=!0),m.ldpe.init({pal:t}),e)return m.tab("edit")},this.tabDisplay=debounce(1e3,function(){var n=m.tabIdx;return ld$.find(m.root,".panel").map(function(t,e){if(n!==e)return t.style.display="none"})}),this}).prototype=o(Object.create(Object.prototype),{on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){for(var e,n,a,l,r=[],i=[],o=1,d=arguments.length;o<d;++o)i.push(arguments[o]);for(e=i,o=0,a=(n=this.evtHandler[t]||[]).length;o<a;++o)l=n[o],r.push(l.apply(this,e));return r},_get:function(){var n=this;return new Promise(function(t,e){return n.access.list.push({res:t,rej:e})})},_set:function(e){return this.access.list.splice(0).map(function(t){return t.res(e)})},get:function(){return this.ldcv?this.ldcv.get():this._get()},tab:function(e){var n,t;if(e&&(this.tabIdx=n=(t=ld$.find(this.root,".panel[data-panel="+e+"]",0))?ld$.index(t):-1,!(n<0)))return ld$.find(this.root,".panels",0).style.transform="translate("+-100*n+"%,0)",ld$.find(this.root,".panel").map(function(t,e){if(n===e)return t.style.display=""}),ld$.find(this.root,".btn[data-panel]").map(function(t){return t.classList.toggle("btn-text",ld$.attr(t,"data-panel")!==e),t.classList.toggle("btn-primary",ld$.attr(t,"data-panel")===e)}),this.tabDisplay(),this.ldpe.syncUi(),!0},random:function(){var t=this.opt.palettes;return this.opt.random?Array.isArray(this.opt.random)?this.opt.random[Math.floor(Math.random()*this.opt.random.length)]:this.opt.random():t[Math.floor(Math.random()*t.length)]}}),o(a,{palettes:[],parse:{text:function(t){return t.split("\n").filter(function(t){return t}).map(function(t){return{name:(t=t.split(",").map(function(t){return t.toLowerCase()}))[0],colors:t[1].split(" ").map(function(t){return"#"+t}),tag:t.slice(2)}})}},register:function(t,e){return"string"==typeof e&&(e=this.parse.text(e)),this.palettes.push([t,e])},get:function(e){return(this.palettes.filter(function(t){return t[0]===e})[0]||["",[]])[1]},init:function(e){var n=(e=null==e?{}:e).pals||this.get("default");return Array.from(document.querySelectorAll("*[ldpp]")).map(function(t){return new a(o({palettes:n,root:t},e))})},defaultPalette:{name:"sample",colors:["#E8614C","#F4A358","#E8DA8D","#2DA88B","#294B59"]}}),a.register("default","flourish,b22 e55 f87 fb6 ab8 898,qualitative\ngray,000 333 666 ddd fff,gradient\nyoung,fec fe6 cd9 acd 7ab aac,concept\nplotDB,ed1e79 c69c6d 8cc63f 29abe2,brand\nFrench,37a 9ab eee f98 c10,diverging\nAfghan Girl,010 253 ffd da8 b53,artwork"),"undefined"!=typeof module&&null!==module?module.exports=a:"undefined"!=typeof window&&null!==window&&(window.ldpp=a)}.call(this);
